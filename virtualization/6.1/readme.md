# DevOps Netology HW 6.1 "Типы и структура СУБД."

### Вопрос 1. 

*Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.*

*Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:*

- *Электронные чеки в json виде*
- *Склады и автомобильные дороги для логистической компании*
- *Генеалогические деревья*
- *Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации*
- *Отношения клиент-покупка для интернет-магазина*

*Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.*

#### Ответ:

* **Электронные чеки в json виде**  
Документоориентированные DB в частности MongoDB. 
  * Данная СУБД заточена под подобный вид данных.
  * Документы могут быть организованы в коллекции. Коллекции в свою очередь, могут содержать другие коллекции.
  * В отличие от хранилищ типа ключ-значение, выборка по запросу к документному хранилищу может содержать части большого количества документов без полной загрузки этих документов в оперативную память

* **Склады и автомобильные дороги для логистической компании**  
Если имеется в виду расчёт оптимальных маршрутов, то тогда следует использовать графовые БД, как раз заточенные под вычисления именно такого типа.

* **Генеалогические деревья**  
Тут соответственно, подходят иерархические базы данных. В такой БД мы получаем дерево со строгой иерархией. 

* **Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации**  
Здесь подходит Redis. Формат "ключ-значение", поддержка TTL, хранение данных в оперативной памяти (высокая скорость доступа к данным).

* **Отношения клиент-покупка для интернет-магазина**  
Очевидно что тут будет несколько связанных друг с другом таблиц. Здесь оптимально будет использовать MySQL/PostgreSQL.


### Вопрос 2. 

*Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):*

- *Данные записываются на все узлы с задержкой до часа (асинхронная запись)*
- *При сетевых сбоях, система может разделиться на 2 раздельных кластера*
- *Система может не прислать корректный ответ или сбросить соединение*

*А согласно PACELC-теореме, как бы вы классифицировали данные реализации?*

#### Ответ:

* **Данные записываются на все узлы с задержкой до часа (асинхронная запись)**  
*Подразумевается, что система всегда доступна, но узлы могут ответить не одинаково (данные не согласованы, но доступны и устойчивы к разделению).*

  * **CAP**: **AP**-система (нет **Consistency**)

  * **PACELC**: *При сетевом разделении базы доступны и не консистентные (**PA**), а вот в случае отсутствия разделения (например, базы синхронизируются в текущий момент), скорее всего будет то, что система будет бороться за время ответа.*  
То есть, ответ - **PA/EL**

* **При сетевых сбоях, система может разделиться на 2 раздельных кластера**  

* Разделение кластера на 2 узла это как раз и является **Partition Tolerance**, так как система в первую очередь остаётся живой, и, случае каких то проблем, будет отвечать всегда. Даже если кластер развалится, то отдельные 
узлы будут отвечать, но не согласованно. Отказаться от **PT** (а значит, выбрать **C** и **A**) значит полагать, что система имеет идеальную связь и никогда не теряет сообщения между своими частями - в нашем случае это не так.*

  * **CAP**: **AP**-система (ибо **Consistency** при развале кластера отсутствует)

  * **PACELC**: *При сетевом разделении базы доступны, но не консистентные (**PA**), в случае же отсутствия разделения (например, базы синхронизируются в текущий момент) приоритеты не понятны, так что может быть как **EL**, так и **EC**.*  
То есть, ответ - **PA/Ex**

* **Система может не прислать корректный ответ или сбросить соединение**  

*Если система не присылает ответ или сбрасывает соединение - значит у нее какие то проблемы. Если система живая, но часть узлов отвалилась, она решает просто игнорировать запросы, чтобы, не дай бог, не дать несогласованные данные.  
Некорректный ответ - это код возврата c описанием проблемы кластера, или при запросе БД разрывает соединение - ну, по факту, она же отвечает. Но отрицательный результат - тоже результат. А вот **Partition Tolerance** она жертвует.*  
*Отказаться от **PT** (а, значит, выбрать **C** и **A**) - значит полагать, что система имеет идеальную связь и никогда не теряет сообщения между своими частями - в нашем случае мы считаем именно так.*  
*Если бы вместо ответа было бы падение по таймауту, то тут уже явная жертва доступности, но её тут нет). Подразумевается, что ИБ все таки отвечает, но не так как мы ожидаем*

  * **CAP**: **AP**-система (нет **consistency**, **availability** присутствует, пусть и кривая)

  * **PACELC**: *При сетевом разделении, базы не доступны. но консистентные,  в  случае отсутствия разделения скорее всего будут готовы к задержкам, но сохранить консистентность*  
То есть, ответ **PC/EC**


### Вопрос 3. 

*Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?*

#### Ответ:

*Если мыслить логически,то не могут.*

**BASE**: Главное - скорость ответа и доступность, достоверность полученных данных - не в приоритете.  

**ACID**: Главное - достоверность данных, скорость уходит на второй план.  

Соответственно, совместить два противоположных принципа в одной системе нереально.


### Вопрос 4. 

*Вам дали задачу написать системное решение, основой которого бы послужили:*

- *фиксация некоторых значений с временем жизни*
- *реакция на истечение таймаута*

*Вы слышали о key-value хранилище, которое имеет механизм Pub/Sub. Что это за система? Какие минусы выбора данной системы?*

#### Ответ:

**Выбор БД:**
*На вышеописанную задачу больше всего подойдёт Redis*  

**Минусы:**
* Все данные лежат в оперативке, следовательно, памяти надо много.*
* Требуется хорошее питание и надежный ИБП, если при скачке напряжения сервер перезагрузиться - данные утеряны.
* Нет гарантии, что подписчик гарантированно получит данные из БД. Если подписчик в текущий момент чем-то занят или не доступен, то, второй раз данные присылать не будет.
